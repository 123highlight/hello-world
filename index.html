<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>èˆ¬è‹¥æ—¥å†</title>
    
    <!-- æ ¸å¿ƒåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lunar-javascript/1.6.12/lunar.min.js"></script>
    <script>if(typeof Lunar === 'undefined') document.write('<script src="https://unpkg.com/lunar-javascript/lunar.js"><\/script>');</script>

    <!-- æ ·å¼ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">

    <style>
        :root {
            --font-cn: "ZCOOL KuaiLe", sans-serif;
            --font-en: "Nunito", sans-serif;
            --primary: #5d6d7e;
            --accent: #e67e22;
            --glass: rgba(255, 255, 255, 0.9);
            --shadow: 0 8px 20px rgba(0,0,0,0.06);
            --tab-height: 60px;
            
            /* å››åŒ–è‰² */
            --c-lu: #27ae60; --c-quan: #f39c12; --c-ke: #8e44ad; --c-ji: #c0392b;
            /* é£æ˜Ÿè‰² */
            --star-water: #2980b9; --star-earth: #d35400; --star-wood: #27ae60; --star-metal: #7f8c8d; --star-fire: #c0392b;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0;
            font-family: var(--font-cn);
            background-color: #eee;
            background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            height: 100vh; overflow: hidden;
            color: #333;
        }

        /* === é¡¶éƒ¨ === */
        .app-header {
            position: fixed; top: 0; left: 0; width: 100%; height: 50px;
            display: flex; align-items: center; padding: 0 20px; 
            padding-top: env(safe-area-inset-top);
            z-index: 100; background: rgba(255,255,255,0.6); backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }
        .logo { font-size: 1.4rem; color: var(--primary); font-weight: bold; letter-spacing: 1px; }

        /* === ä¸»è§†å£ === */
        .main-viewport {
            height: 100%; width: 100%;
            padding-top: calc(50px + env(safe-area-inset-top));
            padding-bottom: calc(var(--tab-height) + env(safe-area-inset-bottom));
            overflow-y: auto; overflow-x: hidden;
            scroll-behavior: smooth;
        }

        .view-section { display: none; padding: 20px; animation: fadeIn 0.3s ease; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* === å¡ç‰‡é€šç”¨ === */
        .card { 
            background: var(--glass); border-radius: 16px; padding: 20px; 
            margin-bottom: 20px; box-shadow: var(--shadow); 
            border: 1px solid rgba(255,255,255,0.5);
        }
        .card h3 { 
            margin: 0 0 15px 0; font-size: 1rem; color: #888; 
            text-transform: uppercase; display: flex; align-items: center; gap: 8px; 
            border-bottom: 1px dashed #eee; padding-bottom: 8px;
        }
        .card h3 i { color: var(--primary); }

        /* === æ—¥å†è§†å›¾ === */
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: #fff; padding: 10px; border-radius: 12px; box-shadow: var(--shadow); }
        .cal-title { font-size: 1.2rem; font-weight: bold; color: var(--primary); }
        .btn-nav { width: 32px; height: 32px; border-radius: 50%; border: none; background: #f0f0f0; color: #555; font-size: 1rem; }

        .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; margin-bottom: 10px; font-size: 0.9rem; color: #888; }
        .days-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        
        .day-cell {
            background: #fff; border-radius: 10px; aspect-ratio: 1;
            display: flex; flex-direction: column; justify-content: flex-start; align-items: center;
            position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.02); padding-top: 4px;
        }
        .day-cell.active { background: var(--primary); color: #fff; box-shadow: 0 4px 10px rgba(93, 109, 126, 0.4); border: 1px solid var(--primary); z-index: 2;}
        .day-cell.active .lunar-num, .day-cell.active .holiday { color: #fff !important; }
        
        .g-num { font-size: 1.1rem; font-weight: bold; line-height: 1.2; }
        .lunar-num { font-size: 0.6rem; color: #999; line-height: 1.2; }
        .holiday { font-size: 0.6rem; color: #c0392b; font-weight: bold; margin-top: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 90%; text-align: center;}
        .tag-chu { position: absolute; bottom: 3px; right: 3px; font-size: 0.5rem; background: #e74c3c; color: #fff; padding: 1px 3px; border-radius: 3px; }

        .astro-item { display: flex; gap: 10px; margin-bottom: 8px; font-size: 0.9rem; align-items: center; border-bottom: 1px dashed rgba(0,0,0,0.05); padding-bottom: 4px;}
        .astro-date { font-weight: bold; color: var(--primary); background: rgba(255,255,255,0.5); padding: 1px 6px; border-radius: 4px; min-width: 45px; text-align: center;}

        /* === ä»Šæ—¥è§†å›¾ === */
        .big-date-box { text-align: center; margin-bottom: 20px; padding: 10px 0; }
        .bd-num { font-size: 5rem; line-height: 1; color: var(--primary); font-weight: bold; letter-spacing: -2px;}
        .bd-lunar { font-size: 1.2rem; margin-top: 5px; color: #555; }
        .bd-gz { background: #fff; padding: 4px 12px; border-radius: 15px; display: inline-block; margin-top: 10px; font-size: 0.95rem; color: #888; border: 1px solid #eee; }

        /* å®œå¿Œ */
        .yiji-row { display: flex; margin-bottom: 8px; font-size: 1rem; line-height: 1.5; align-items: flex-start;}
        .badge { padding: 2px 8px; border-radius: 6px; font-size: 0.8rem; font-weight: bold; margin-right: 10px; height: fit-content; white-space: nowrap; }
        .bg-yi { background: #e8f5e9; color: #27ae60; }
        .bg-ji { background: #ffebee; color: #c0392b; }
        
        /* èƒ½é‡ä¿¡æ¯ */
        .info-grid { display: grid; grid-template-columns: 1fr; gap: 8px; font-size: 0.95rem; color: #555; }
        .info-item { display: flex; justify-content: space-between; border-bottom: 1px dashed #f0f0f0; padding-bottom: 5px;}
        .info-item b { color: #444; }

        /* Tips */
        .tips-box { font-size: 1.05rem; color: #444; line-height: 1.6; font-weight: bold; color: var(--primary);}

        /* æ—¥è®° */
        .journal-area { background: #fff; border-radius: 12px; padding: 15px; border: 1px solid #eee; }
        #journalInput { width: 100%; height: 100px; border: none; outline: none; resize: none; font-size: 1rem; line-height: 1.6; background: transparent; font-family: var(--font-cn); }

        /* === ç„å­¦é¡µ (æœ‰ç‚¹ç„) === */
        .star-list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f0f0f0; font-size: 1rem; }
        .star-tag { font-weight: bold; font-size: 1.1rem; }

        /* å››åŒ–åˆ—è¡¨ */
        .sihua-table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
        .sihua-table td { padding: 8px 4px; text-align: center; border-bottom: 1px dashed #eee; }
        .sh-label { font-weight: bold; text-align: left; color: #666; }
        .c-lu { color: var(--c-lu); font-weight: bold;} 
        .c-quan { color: var(--c-quan); font-weight: bold;} 
        .c-ke { color: var(--c-ke); font-weight: bold;} 
        .c-ji { color: var(--c-ji); font-weight: bold;}

        /* åº•éƒ¨ Tab */
        .tab-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: calc(var(--tab-height) + env(safe-area-inset-bottom));
            background: #fff; border-top: 1px solid #eee; display: flex; justify-content: space-around; padding-top: 8px; z-index: 99;
        }
        .tab-item { display: flex; flex-direction: column; align-items: center; color: #ccc; font-size: 0.7rem; transition: 0.2s;}
        .tab-item i { font-size: 1.4rem; margin-bottom: 2px; }
        .tab-item.active { color: var(--primary); transform: translateY(-2px); }

        ::-webkit-scrollbar { width: 0px; background: transparent; }

        @media (max-width: 900px) {
            .app-container { flex-direction: column; height: auto; width: 100%; border-radius: 0; }
            .glass-panel { flex-direction: column; height: auto; border-radius: 0; border: none; }
            .left-panel, .right-panel { width: 100%; padding: 20px; overflow: visible; flex-direction: column; }
        }
    </style>
</head>
<body>

    <header class="app-header">
        <div class="logo">âœï¸ Panna</div>
    </header>

    <main class="main-viewport">
        <!-- è§†å›¾1ï¼šæ—¥å† -->
        <div id="view-cal" class="view-section active">
            <div class="calendar-header">
                <button class="btn-nav" onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                <div class="cal-title" id="calTitle">...</div>
                <button class="btn-nav" onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div class="weekdays"><span>æ—¥</span><span>ä¸€</span><span>äºŒ</span><span>ä¸‰</span><span>å››</span><span>äº”</span><span>å…­</span></div>
            <div class="days-grid" id="calendarGrid"></div>
            
            <div class="card" style="margin-top: 20px;">
                <h3><i class="fas fa-star"></i> æœ¬æœˆé‡è¦å¤©è±¡</h3>
                <div id="astroList"></div>
            </div>
        </div>

        <!-- è§†å›¾2ï¼šä»Šæ—¥ (æç®€) -->
        <div id="view-today" class="view-section">
            <div class="big-date-box">
                <div class="bd-num" id="todayDay">--</div>
                <div class="bd-lunar" id="todayLunar">åŠ è½½ä¸­...</div>
                <div class="bd-gz" id="todayGanZhi"></div>
            </div>

            <div class="card">
                <h3><i class="fas fa-scroll"></i> æœ¬æ—¥å®œå¿Œ</h3>
                <div class="yiji-row">
                    <span class="badge bg-yi">å®œ</span> <span id="todayYi"></span>
                </div>
                <div class="yiji-row">
                    <span class="badge bg-ji">å¿Œ</span> <span id="todayJi"></span>
                </div>
            </div>

            <div class="card">
                <h3><i class="fas fa-bolt"></i> èƒ½é‡æ–¹ä½</h3>
                <div class="info-grid">
                    <div class="info-item"><span>è´¢ç¥</span> <b id="godCai"></b></div>
                    <div class="info-item"><span>å–œç¥ (å§»ç¼˜)</span> <b id="godXi"></b></div>
                    <div class="info-item"><span>ç¦ç¥ (è´µäºº)</span> <b id="godFu"></b></div>
                    <div class="info-item"><span>å†²ç…</span> <b id="chongSha"></b></div>
                </div>
            </div>

            <div class="card">
                <h3><i class="fas fa-lightbulb"></i> æ¯æ—¥Tips</h3>
                <div class="tips-box" id="todayAdvice"></div>
            </div>

            <div class="card">
                <h3><i class="fas fa-pen"></i> å¿ƒæƒ…éšè®°</h3>
                <div class="journal-area">
                    <textarea id="journalInput" placeholder="å†™ä¸‹ä»Šå¤©çš„æ„Ÿå—... (è‡ªåŠ¨ä¿å­˜)"></textarea>
                </div>
            </div>
        </div>

        <!-- è§†å›¾3ï¼šæœ‰ç‚¹ç„ (ç„å­¦æ•°æ®) -->
        <div id="view-pro" class="view-section">
            <h2 style="margin-bottom:20px; color:var(--primary);">æœ‰ç‚¹ç„</h2>
            
            <div class="card">
                <h3><i class="fas fa-th"></i> ä¹å®«é£æ˜Ÿ</h3>
                <div id="fsList">
                    <!-- JS å¡«å…… -->
                </div>
            </div>

            <div class="card">
                <h3><i class="fas fa-bahai"></i> ç´«å¾®å››åŒ–</h3>
                <table class="sihua-table" id="sihuaTable">
                    <!-- JS å¡«å…… -->
                </table>
            </div>
        </div>

    </main>

    <nav class="tab-bar">
        <div class="tab-item active" onclick="switchTab('view-cal', this)">
            <i class="fas fa-calendar-alt"></i> <span>æ—¥å†</span>
        </div>
        <div class="tab-item" onclick="switchTab('view-today', this)">
            <i class="fas fa-sun"></i> <span>ä»Šæ—¥</span>
        </div>
        <div class="tab-item" onclick="switchTab('view-pro', this)">
            <i class="fas fa-yin-yang"></i> <span>æœ‰ç‚¹ç„</span>
        </div>
    </nav>

    <script>
        // === å…¨å±€å˜é‡ ===
        let currentDate = new Date();
        let selectedDate = new Date();
        const monthNames = ["1æœˆ","2æœˆ","3æœˆ","4æœˆ","5æœˆ","6æœˆ","7æœˆ","8æœˆ","9æœˆ","10æœˆ","11æœˆ","12æœˆ"];
        
        // === æ˜Ÿè±¡åº“ (2025-2027) ===
        const AstroDB = {
            "2025-10": [{d:24,t:"å¤ªé˜³è¿›å¤©è"}],
            "2025-11": [{d:9,t:"æ°´é€†å¼€å§‹"},{d:20,t:"å†¥ç‹è¿›æ°´ç“¶"},{d:27,t:"åœŸæ˜Ÿé¡ºè¡Œ"},{d:29,t:"æ°´æ˜Ÿé¡ºè¡Œ"}],
            "2025-12": [{d:21,t:"å†¬è‡³"}],
            "2026-1": [{d:20,t:"å¤ªé˜³è¿›æ°´ç“¶"}],
            "2026-2": [{d:14,t:"åœŸæ˜Ÿè¿›ç™½ç¾Š"},{d:17,t:"æ—¥ç¯é£Ÿ"},{d:26,t:"æ°´é€†å¼€å§‹"}],
            "2026-4": [{d:26,t:"æµ·ç‹è¿›ç™½ç¾Š"}],
            "2026-6": [{d:9,t:"æœ¨æ˜Ÿè¿›å·¨èŸ¹"},{d:29,t:"æ°´é€†å¼€å§‹"}],
            "2026-7": [{d:7,t:"å¤©ç‹è¿›åŒå­"}],
            "2026-8": [{d:12,t:"æ—¥å…¨é£Ÿ"}],
            "2026-10": [{d:3,t:"é‡‘æ˜Ÿé€†è¡Œ"},{d:24,t:"æ°´é€†å¼€å§‹"}],
            "2027-1": [{d:2,t:"ç«æ˜Ÿé€†è¡Œ"}],
            "2027-2": [{d:6,t:"æ—¥ç¯é£Ÿ"},{d:20,t:"æ°´é€†å¼€å§‹"}],
            "default": [{d:22,t:"å¤ªé˜³æ¢åº§"}]
        };
        
        // ç°ä»£å®œå¿Œç™½åå•
        const ModernEvents = ["å‡ºè¡Œ","çº³è´¢","å…¥å®…","å«å¨¶","äº¤æ˜“","ä¼šå‹","ç­¾çº¦","è£…ä¿®","æ¬å®¶","ç¥ˆç¦","å¼€å¸‚","åŠ¨åœŸ","ç½®äº§","å®‰åºŠ","ç†å‘","æ±‚åŒ»"];
        
        // èƒŒæ™¯å›¾é…ç½®
        const bgImages = [
            "https://images.unsplash.com/photo-1494438639946-1ebd1d20bf85?q=80&w=1000", 
            "https://images.unsplash.com/photo-1507643179173-39db2965446c?q=80&w=1000", 
            "https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=1000", 
            "https://images.unsplash.com/photo-1589829085413-56de8ae18c73?q=80&w=1000", 
            "https://images.unsplash.com/photo-1530982011887-3cc11cc85693?q=80&w=1000", 
            "https://images.unsplash.com/photo-1518640467707-6811f4a6ab73?q=80&w=1000", 
            "https://images.unsplash.com/photo-1557683316-973673baf926?q=80&w=1000", 
            "https://images.unsplash.com/photo-1506259091721-347f798196d4?q=80&w=1000", 
            "https://images.unsplash.com/photo-1558591710-4b4a1ae0f04d?q=80&w=1000", 
            "https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=1000", 
            "https://images.unsplash.com/photo-1483232539664-d89d58f8f159?q=80&w=1000", 
            "https://images.unsplash.com/photo-1493246507139-91e8fad9978e?q=80&w=1000"
        ];
        const seasonColors = ["#95a5a6", "#d2b4de", "#a9dfbf", "#a3e4d7", "#f5cba7", "#aed6f1", "#f1948a", "#edbb99", "#d7bde2", "#abb2b9", "#566573", "#808b96"];

        // === åˆå§‹åŒ– ===
        window.onload = function() {
            if(typeof Lunar === 'undefined') { alert("ç»„ä»¶åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°"); return; }
            renderHome();
            document.getElementById('journalInput').addEventListener('input', function(){
                localStorage.setItem('panna_j_'+getDateKey(selectedDate), this.value);
            });
        };

        function switchTab(viewId, btn) {
            document.querySelectorAll('.view-section').forEach(e => e.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            document.querySelectorAll('.tab-item').forEach(e => e.classList.remove('active'));
            btn.classList.add('active');
        }

        function renderHome() {
            const m = currentDate.getMonth();
            document.body.style.backgroundImage = `url('${bgImages[m]}')`;
            document.documentElement.style.setProperty('--season-accent', seasonColors[m]);
            
            renderCalendar();
            updateDetails(selectedDate);
            
            const k = `${currentDate.getFullYear()}-${currentDate.getMonth()+1}`;
            const events = AstroDB[k] || AstroDB["default"];
            document.getElementById('astroList').innerHTML = events.map(e => `<div class="astro-item"><span class="astro-date">${e.d}æ—¥</span><span>${e.t}</span></div>`).join('');
        }

        function changeMonth(n) {
            currentDate.setMonth(currentDate.getMonth() + n);
            renderHome();
        }

        function renderCalendar() {
            const y = currentDate.getFullYear();
            const m = currentDate.getMonth();
            document.querySelector('.cal-title').innerText = `${y}å¹´ ${m+1}æœˆ`;
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            const firstDay = new Date(y, m, 1).getDay();
            const days = new Date(y, m+1, 0).getDate();

            for(let i=0; i<firstDay; i++) grid.innerHTML += `<div></div>`;

            for(let i=1; i<=days; i++) {
                const d = new Date(y, m, i);
                const l = Lunar.fromDate(d);
                const isSel = d.toDateString() === selectedDate.toDateString();
                
                let txt = l.getDayInChinese();
                let style = "";
                let tag = "";

                const fs = l.getFestivals();
                const jq = l.getJieQi();
                const major = ["æ˜¥èŠ‚","å…ƒå®µèŠ‚","ç«¯åˆèŠ‚","ä¸ƒå¤•èŠ‚","ä¸­ç§‹èŠ‚","é‡é˜³èŠ‚","é™¤å¤•","å›½åº†èŠ‚","åŠ³åŠ¨èŠ‚","å…ƒæ—¦"];
                
                if(fs.length && major.includes(fs[0])) { 
                    tag = `<div class="holiday">${fs[0]}</div>`; 
                    txt = ""; 
                } else if (jq) {
                    tag = `<div class="holiday" style="color:#d35400">${jq}</div>`;
                    txt = "";
                } else if(txt==='åˆä¸€'||txt==='åäº”') {
                    style = "color:#d35400;font-weight:bold";
                }
                
                if(l.getZhiXing() === 'é™¤') tag += `<div class="tag-chu">é™¤</div>`;

                const div = document.createElement('div');
                div.className = `day-cell ${isSel?'active':''}`;
                div.innerHTML = `<span class="g-num">${i}</span><span class="lunar-num" style="${style}">${txt}</span>${tag}`;
                div.onclick = () => { 
                    selectedDate = d; renderCalendar(); updateDetails(d); 
                    switchTab('view-today', document.querySelectorAll('.tab-item')[1]); 
                };
                grid.appendChild(div);
            }
        }

        function updateDetails(date) {
            const l = Lunar.fromDate(date);
            
            document.getElementById('todayDay').innerText = date.getDate();
            document.getElementById('todayLunar').innerText = `å†œå† ${l.getMonthInChinese()}æœˆ${l.getDayInChinese()}`;
            document.getElementById('todayGanZhi').innerText = `${l.getYearInGanZhi()}å¹´ ${l.getMonthInGanZhi()}æœˆ ${l.getDayInGanZhi()}æ—¥`;

            // å®œå¿Œ
            const yi = l.getDayYi().filter(x=>ModernEvents.includes(x));
            const ji = l.getDayJi().filter(x=>ModernEvents.includes(x));
            document.getElementById('todayYi').innerText = yi.length ? yi.join(' ') : "å¹³";
            document.getElementById('todayJi').innerText = ji.length ? ji.join(' ') : "å¹³";
            
            // å‰æ–¹ (ç™½è¯)
            document.getElementById('godCai').innerText = mapDir(l.getDayPositionCai());
            document.getElementById('godXi').innerText = mapDir(l.getDayPositionXi());
            document.getElementById('godFu').innerText = mapDir(l.getDayPositionFu());
            document.getElementById('chongSha').innerText = `å†²${l.getDayChongDesc()} ç…${mapDir(l.getDaySha())}`;

            // Tips (æ™ºèƒ½ç”Ÿæˆ)
            let tip = "ğŸŒˆ ä¿æŒå¹³å’Œï¼Œäº«å—å½“ä¸‹çš„æ¯ä¸€ä¸ªç¬é—´ã€‚";
            const yg = l.getYearGan();
            
            // ä¼˜å…ˆæ˜Ÿè±¡
            const k = `${date.getFullYear()}-${date.getMonth()+1}`;
            if(AstroDB[k]) {
                const evt = AstroDB[k].find(e=>e.d===date.getDate());
                if(evt) tip = `ğŸ’¡ æ˜Ÿè±¡æç¤ºï¼š${evt.t}ï¼Œè¯·é¡ºåº”èƒ½é‡å˜åŒ–ã€‚`;
                else if(AstroDB[k].some(e=>e.t.includes("æ°´é€†å¼€å§‹"))) tip = "ğŸŒŠ æ°´æ˜Ÿé€†è¡ŒæœŸé—´ï¼Œè¯·å¤šåšå†…çœï¼Œè°¨æ…æ²Ÿé€šã€‚";
            }
            // å…¶æ¬¡èŠ‚æ°”/èŠ‚æ—¥
            const fs = l.getFestivals();
            const jq = l.getJieQi();
            if(fs.length) tip = `ğŸ‰ ä»Šå¤©æ˜¯${fs[0]}ï¼Œç¥æ‚¨èŠ‚æ—¥å¿«ä¹ï¼`;
            else if(jq) tip = `ğŸŒ± ä»Šæ—¥${jq}ï¼Œé¡ºåº”å¤©æ—¶ï¼Œè°ƒæ•´èº«å¿ƒã€‚`;
            
            // å†æ¬¡å››åŒ–/é£æ˜Ÿ
            else {
                 if(yg === "ç”²") tip = "ğŸ’° å»‰è´åŒ–ç¦„ï¼Œåˆ©äºç¤¾äº¤ä¸åˆ›æ–°ï¼Œä¿æŒå¼€æ”¾å¿ƒæ€ã€‚";
                 if(yg === "ä¸") tip = "ğŸŒ™ å¤ªé˜´åŒ–ç¦„ï¼Œè´¢è¿ä¸é”™ï¼Œä¹Ÿé€‚åˆå…³æ³¨å®¶åº­ã€‚";
                 if(l.getDay()===1) tip = "ğŸŒ‘ æ–°æœˆæ—¥ï¼Œé€‚åˆè®¸ä¸‹æœ¬æœˆå¿ƒæ„¿ã€‚";
                 if(l.getZhiXing()==='é™¤') tip = "ğŸ§¹ é™¤æ—¥ï¼Œé€‚åˆå¤§æ‰«é™¤ï¼Œæ¸…ç†è´Ÿèƒ½é‡ã€‚";
            }
            
            document.getElementById('todayAdvice').innerText = tip;

            // åˆ·æ–°ç¬¬ä¸‰é¡µæ•°æ®
            renderProView(l);

            document.getElementById('journalInput').value = localStorage.getItem('panna_j_'+getDateKey(date)) || "";
        }

        function renderProView(l) {
            // é£æ˜Ÿåˆ—è¡¨
            const yS = getNum(l.getYearNineStar());
            const mS = getNum(l.getMonthNineStar());
            const dS = getNum(l.getDayNineStar());
            const colorize = (n, txt) => {
                const colors = ["","blue","black","green","green","orange","gray","red","white","purple"];
                return `<span style="color:${colors[n]}; font-weight:bold;">${txt}</span>`;
            };
            
            document.getElementById('fsList').innerHTML = `
                <div class="star-list-item"><span style="color:#666">æµå¹´ (${l.getYearInGanZhi()})</span> <span class="star-tag">${colorize(yS, l.getYearNineStar().toString())}</span></div>
                <div class="star-list-item"><span style="color:#666">æµæœˆ (${l.getMonthInGanZhi()})</span> <span class="star-tag">${colorize(mS, l.getMonthNineStar().toString())}</span></div>
                <div class="star-list-item"><span style="color:#666">æµæ—¥ (${l.getDayInGanZhi()})</span> <span class="star-tag">${colorize(dS, l.getDayNineStar().toString())}</span></div>
            `;

            // å››åŒ–è¡¨æ ¼
            const table = document.getElementById('sihuaTable');
            const getStars = (g) => {
                const map = {"ç”²":["å»‰è´","ç ´å†›","æ­¦æ›²","å¤ªé˜³"],"ä¹™":["å¤©æœº","å¤©æ¢","ç´«å¾®","å¤ªé˜´"],"ä¸™":["å¤©åŒ","å¤©æœº","æ–‡æ˜Œ","å»‰è´"],"ä¸":["å¤ªé˜´","å¤©åŒ","å¤©æœº","å·¨é—¨"],"æˆŠ":["è´ªç‹¼","å¤ªé˜´","å³å¼¼","å¤©æœº"],"å·±":["æ­¦æ›²","è´ªç‹¼","å¤©æ¢","æ–‡æ›²"],"åºš":["å¤ªé˜³","æ­¦æ›²","å¤ªé˜´","å¤©åŒ"],"è¾›":["å·¨é—¨","å¤ªé˜³","æ–‡æ›²","æ–‡æ˜Œ"],"å£¬":["å¤©æ¢","ç´«å¾®","å·¦è¾…","æ­¦æ›²"],"ç™¸":["ç ´å†›","å·¨é—¨","å¤ªé˜´","è´ªç‹¼"]};
                return map[g] || ["-","-","-","-"];
            }
            const row = (lbl, s) => `<tr><td>${lbl}</td><td class="c-lu">${s[0]}</td><td class="c-quan">${s[1]}</td><td class="c-ke">${s[2]}</td><td class="c-ji">${s[3]}</td></tr>`;
            
            const yg=l.getYearGan(), mg=l.getMonthGan(), dg=l.getDayGan();
            table.innerHTML = `
                <tr><th></th><th class="c-lu">ç¦„</th><th class="c-quan">æƒ</th><th class="c-ke">ç§‘</th><th class="c-ji">å¿Œ</th></tr>
                ${row(yg+'å¹´', getStars(yg))}
                ${row(mg+'æœˆ', getStars(mg))}
                ${row(dg+'æ—¥', getStars(dg))}
            `;
        }

        function mapDir(d) { const m={"å":"æ­£åŒ—","ç¦»":"æ­£å—","éœ‡":"æ­£ä¸œ","å…‘":"æ­£è¥¿","å·½":"ä¸œå—","å¤":"è¥¿å—","è‰®":"ä¸œåŒ—","ä¹¾":"è¥¿åŒ—","ä¸­":"ä¸­å®«"}; return m[d]||d; }
        function getNum(s) { let n=parseInt(s.getNumber()); return isNaN(n)?5:n; }
        function getDateKey(d) { return `${d.getFullYear()}-${d.getMonth()}-${d.getDate()}`; }
    </script>
</body>
</html>
